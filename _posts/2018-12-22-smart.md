---
layout: post
title: "나를 부탁해!"
date: 2018-12-22 12:00:00
tags: smart sensor
author: Jason Koo
---
<amp-img src="{{ site.baseurl }}assets/images/smart/logo.jpeg" width="746" height="732" layout="responsive" alt="" class="mb3"></amp-img>


# 개요

현대인들이 집을 비우는 시간이 길어지면서, 반려동물들 또한 집에서 홀로 보내는 시간이 길어지고 있습니다. 

집을 장시간 비우게 될 경우 반려동물 스스로 밥이나 물을 스스로 챙겨먹기 어렵다는 점, 또 외로움을 느낀다는 점을 고려해

일정 시간이 되면 자동으로 급식/급수하는 장치를 LEGO MINDSTORM 3와 ROBOT C 언어를 이용해 만들어보기로 했습니다.

# 필요한 기능

1. 급식 기능
2. 급수 기능
3. 특정 상황시 주인 목소리 출력

# 전체적인 프로토 타입 구상

<amp-img src="{{ site.baseurl }}assets/images/smart/earlyproto1.png" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>
<amp-img src="{{ site.baseurl }}assets/images/smart/earrlyproto2.png" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>

# 첫 번째 목표: 급식 기능 구현

밥을 "정해진 시간"에 "일정량" 나오게 하는 것이 관건이었습니다.

구조는 위쪽에 위치한 밥통의 입구와 리드의 구멍이 일치하는 경우 밥이 그릇으로 떨어지는 구조로 구현해보기로 하였습니다.

<amp-img src="{{ site.baseurl }}assets/images/smart/foodproto.jpeg" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>
<amp-img src="{{ site.baseurl }}assets/images/smart/foodpic.jpeg" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>

### 어떻게 정해진 시간에 나오게 할 것인가?

초기 단계에선 실제 시간을 불러와 주인이 설정한 시간에 맞추어 밥을 주는 것을 기획했으나, 실제 시간을 불러오지 못했습니다.

따라서 주인이 외출 시 버튼을 누르고 나가면 N시간에 한번 밥이 나오도록 구현을 하였습니다.

또한 밥이 나올 때 마다 물도 같이 나오도록 하였습니다.
 

### 어떻게 일정량을 줄 것인가?

밥의 양은 리드와 구멍이 일치하는 시간으로 조절하기로 하였습니다.

또한 밥이 리드에 걸려 나오지 않는 문제를 해결하기 위해, 리드가 앞뒤로 이동할 때 좌우로 약간의 흔들림을 주기 위해 좌우 크기가 다른 톱니바퀴를 사용하였습니다.

이렇게 하게 되면 밥이 걸렸을 경우, 리드가 비틀리면서 걸린 부분을 흔들어 주게 되면서 밥이 걸리지 않고 나오게 됩니다.

<amp-img src="{{ site.baseurl }}assets/images/smart/foodpic.jpeg" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>

<밥영상>


### 밥 전체 작동 동영상 <밥.mp4>
[![급식 기능 동영상](http://img.youtube.com/vi/gOvtueTeT9M/0.jpg)](https://youtu.be/gOvtueTeT9M?t=0s)

중간 시연의 동영상은 [여기](https://youtu.be/gOvtueTeT9M)서 확인 가능합니다.

### 밥 부분 사진

<amp-img src="{{ site.baseurl }}assets/images/smart/food1.png" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>
<amp-img src="{{ site.baseurl }}assets/images/smart/food2.png" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>
<amp-img src="{{ site.baseurl }}assets/images/smart/food3.png" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>


# 두 번째 목표: 급수 기능

물은 강아지가 터치센서를 누르면 나오는 방식으로 구현하기로 였습니다.

급수 기능은 급식 기능보다 구현하기가 좀 더 까다로웠는데요,

급식 기능처럼 구멍을 맞추는 방식으로 구현한다면 물이 갑자기 확 나오거나 주변으로 튈 수 있는 위험이 있습니다. 

또한 수압 때문에 오히려 물이 나오지 않는 경우가 발생하기도 합니다.

따라서 다음과 같은 방식으로 구현해보기로 하였습니다.

<amp-img src="{{ site.baseurl }}assets/images/smart/waterproto.jpeg" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>

호스의 높이를 조절하는 막대가 위아래로 움직이면서, 수압에 의해 물이 나오게 됩니다.

[![급수 기능 동영상](http://img.youtube.com/vi/gOvtueTeT9M/0.jpg)](https://youtu.be/gOvtueTeT9M?t=0s)
<물>

급수 기능의 동영상은 [여기](https://youtu.be/gOvtueTeT9M)서 확인 가능합니다.

<물1>


# 세 번째 목표: 특정 상황시 주인 목소리 출력

"밥먹자", "밥먹어", "물먹자", "괜찮아" 등의 음성을 녹음해서 특정 상황마다 출력하려 했으나,

EV3 자체 프로그램이 아닌 ROBOT C 프로그램으로 코딩을 할 경우

녹음된 음성 파일을 rsf 포맷으로 변환을 해도 외부 음성 파일을 인식하지 못하는 문제가 발생하여 중단하였습니다.



### * 최종 시연에 사용된 ROBOT C 코드 자료 및 설명

```c

#pragma config(Sensor, S3,ts,             sensorEV3_Touch)
#pragma config(Motor,  motorB,          wm,            tmotorEV3_Large, PIDControl, encoder)
#pragma config(Motor,  motorC,          fm,            tmotorEV3_Large, PIDControl, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

int n = 0;

void water(){

		sleep(1);
		setMotorSpeed(wm, 30);
		sleep(500);
		setMotorSpeed(wm, 0); // 물이 나올 시간을 확보
		sleep(2000);
		setMotorSpeed(wm, -30);
		sleep(500);
		setMotorSpeed(wm, 0);
}

void food(){
    
		setMotorSpeed(fm,-15);
		sleep(2000);
		setMotorSpeed(fm, 0); // 밥이 나올 시간을 확보 
		sleep(4000);
		setMotorSpeed(fm,15);
		sleep(1000);

}

task main()
{
	while(1){
		while(getTouchValue(ts) == 0){
			sleep(500);
			displayBigTextLine(2,"n = %d",n); // 시간의 흐름을 보여줌
			n++;
			if(n == 10){
				food();
				water();
				n = 0;
			}
		}
		while(getTouchValue(ts) == 1){
			water();
		}
	}
}

```


### 최종 시연 동영상
[![최종 시연 동영상](http://img.youtube.com/vi/sGXLG-uNgV4/0.jpg)](https://youtu.be/sGXLG-uNgV4?t=0s)
<최종발표>
최종 시연의 동영상은 [여기](https://youtu.be/sGXLG-uNgV4)서 확인 가능합니다.

### 최종 시연에 사용된 PPT 발표 자료
[이 곳](https://github.com/retrowavve/retrowavve.github.io/blob/master/assets/images/ddego_presentation.pptx)에서 다운로드가 가능합니다.

# 느낀 점 및 배운 점

  처음 프로젝트를 시작할 때만 해도 과연 내가 이 문제를 끝까지 해결할 수 있을까 하는 의문이 들었다. 1학기 때 배운 파이썬 지식이 부족해서 코딩하는 데에 애도 많이 먹었고 시간도 많이 들었다. 팀원들의 시간표, 사는 곳도 모두 달라서 따로 짬을 내서 만나는 것도 어려웠다. 하지만 이렇게 프로젝트를 끝까지 마치고 나니 수업시간 외에도 내가 무언가 스스로 만들어 볼 수 있다는 자신감이 생겼다. 또 문제가 되는 부분을 직접 구글링을 통해 해결책을 찾다 보니, 어떤 상황에서 어떻게 대처해야 하는지 더 기억 속에 잘 남았다. 
  다음 번에 비슷한 프로젝트를 진행할 때는 서버에서 음악을 다운로드 받아서 재생하는 방식이 아닌, 서버에서 직접 스트리밍은 어떻게 하는지 구현해보고 싶다. 또 현재 기기에 달려있는 흑백 LCD가 아닌, 더 많은 정보를 표현할 수 있는 컬러 LCD를 장착해서 기기를 시연해보고 싶다.
  일단 조장으로 선택된 상황에서 조장으로서 팀원들에게 역할을 잘 분배하고 팀을 잘 이끌어 나갔어야 하는데 리더십이 부족했던 점이 아쉽고, 다음 번엔 이번 경험을 밑거름 삼아 더욱 발전하도록 노력해야겠다. 

