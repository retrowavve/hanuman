---
layout: post
title: "나를 부탁해!"
date: 2018-12-22 12:00:00
tags: smart sensor
author: Jason Koo
---
<amp-img src="{{ site.baseurl }}assets/images/smart/logo.jpeg" width="746" height="732" layout="responsive" alt="" class="mb3"></amp-img>


# 개요

현대인들이 집을 비우는 시간이 길어지면서, 반려동물들 또한 집에서 홀로 보내는 시간이 길어지고 있습니다. 

집을 장시간 비우게 될 경우 반려동물 스스로 밥이나 물을 스스로 챙겨먹기 어렵다는 점, 또 외로움을 느낀다는 점을 고려해 일정 시간이 되면 자동으로 급식/급수하는 장치를 LEGO MINDSTORM 3와 ROBOT C 언어를 이용해 만들어보기로 했습니다.

# 필요한 기능

1. 급식 기능
2. 급수 기능
3. 특정 상황시 주인 목소리 출력

# 전체적인 프로토 타입 구상

<amp-img src="{{ site.baseurl }}assets/images/smart/earlyproto1.png" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>
<amp-img src="{{ site.baseurl }}assets/images/smart/earrlyproto2.png" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>

# 첫 번째 목표: 급식 기능 구현

밥을 "정해진 시간"에 "일정량" 나오게 하는 것이 관건이었습니다.

구조는 위쪽에 위치한 밥통의 입구와 리드의 구멍이 일치하는 경우 밥이 그릇으로 떨어지는 구조로 구현해보기로 하였습니다.

<amp-img src="{{ site.baseurl }}assets/images/smart/foodproto.jpeg" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>
<amp-img src="{{ site.baseurl }}assets/images/smart/foodpic.jpeg" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>


### 어떻게 정해진 시간에 나오게 할 것인가?

초기 단계에선 실제 시간을 불러와 주인이 설정한 시간에 맞추어 밥을 주는 것을 기획했으나, 실제 시간을 불러오지 못했습니다.

따라서 주인이 외출 시 버튼을 누르고 나가면 N시간에 한번 밥이 나오도록 구현을 하였습니다.

또한 밥이 나올 때 마다 물도 같이 나오도록 하였습니다.
 
 

### 어떻게 일정량을 줄 것인가?

밥의 양은 리드와 구멍이 일치하는 시간으로 조절하기로 하였습니다.

또한 밥이 리드에 걸려 나오지 않는 문제를 해결하기 위해, 리드가 앞뒤로 이동할 때 좌우로 약간의 흔들림을 주기 위해 좌우 크기가 다른 톱니바퀴를 사용하였습니다.

이렇게 하게 되면 밥이 걸렸을 경우, 리드가 비틀리면서 걸린 부분을 흔들어 주게 되면서 밥이 걸리지 않고 나오게 됩니다.


### 급식 부분 프로토타입 및 영상

<amp-img src="{{ site.baseurl }}assets/images/smart/foodpic.jpeg" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>

[![급식 기능 프로토타입](http://img.youtube.com/vi/6vA1jK3CwDw/0.jpg)](https://youtu.be/6vA1jK3CwDw?t=0s)


급식 기능 프로토타입 작동영상은 [여기](https://youtu.be/6vA1jK3CwDw)서 확인 가능합니다.


### 급식 부분 작동 영상
[![급식 기능 작동 영상](http://img.youtube.com/vi/YhPrZVBfhKI/0.jpg)](https://youtu.be/YhPrZVBfhKI?t=0s)

급식 부분의 작동영상은 [여기](https://youtu.be/YhPrZVBfhKI)서 확인 가능합니다.

### 급식 부분 사진

<amp-img src="{{ site.baseurl }}assets/images/smart/food1.png" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>
<amp-img src="{{ site.baseurl }}assets/images/smart/food2.png" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>
<amp-img src="{{ site.baseurl }}assets/images/smart/food3.png" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>


# 두 번째 목표: 급수 기능

물은 강아지가 터치센서를 누르면 나오는 방식으로 구현하기로 였습니다.

급수 기능은 급식 기능보다 구현하기가 좀 더 까다로웠는데요,

급식 기능처럼 구멍을 맞추는 방식으로 구현한다면 물이 갑자기 확 나오거나 주변으로 튈 수 있는 위험이 있습니다. 

또한 수압 때문에 오히려 물이 나오지 않는 경우가 발생하기도 합니다.

따라서 다음과 같은 방식으로 구현해보기로 하였습니다.

<amp-img src="{{ site.baseurl }}assets/images/smart/waterproto.jpeg" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>

호스의 높이를 조절하는 막대가 위아래로 움직이면서, 수압에 의해 물이 나오게 됩니다.

### 급식 부분 프로토타입 및 사진

[![급수 기능 "프로토타입" 동영상](http://img.youtube.com/vi/EIERcRg1diA/0.jpg)](https://youtu.be/EIERcRg1diA)

급수 기능의 프로토타입 동영상은 [여기](https://youtu.be/EIERcRg1diA)서 확인 가능합니다.

<amp-img src="{{ site.baseurl }}assets/images/smart/water1.png" width="660" height="480" layout="responsive" alt="" class="mb3"></amp-img>



# 세 번째 목표: 특정 상황시 주인 목소리 출력

"밥먹자", "밥먹어", "물먹자", "괜찮아" 등의 음성을 녹음해서 특정 상황마다 출력하려 했으나,

EV3 자체 프로그램이 아닌 ROBOT C 프로그램으로 코딩을 할 경우

녹음된 음성 파일을 rsf 포맷으로 변환을 해도 외부 음성 파일을 인식하지 못하는 문제가 발생하여 중단하였습니다.


# 전체 작동 영상

각 부분의 프로토타입을 보완 한 후, 호스 등을 장착한 뒤 전체적으로 작동하는 모습입니다.

[![전체 작동 동영상](http://img.youtube.com/vi/nC1LY3DLXi8/0.jpg)](https://youtu.be/nC1LY3DLXi8)

# 사용된 ROBOT C 코드 자료 및 설명

```c

#pragma config(Sensor, S3,ts,             sensorEV3_Touch)
#pragma config(Motor,  motorB,          wm,            tmotorEV3_Large, PIDControl, encoder)
#pragma config(Motor,  motorC,          fm,            tmotorEV3_Large, PIDControl, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

int n = 0;

void water(){

		sleep(1);
		setMotorSpeed(wm, 30);
		sleep(500);
		setMotorSpeed(wm, 0); // 물이 나올 시간을 확보
		sleep(2000);
		setMotorSpeed(wm, -30);
		sleep(500);
		setMotorSpeed(wm, 0);
}

void food(){
    
		setMotorSpeed(fm,-15);
		sleep(2000);
		setMotorSpeed(fm, 0); // 밥이 나올 시간을 확보 
		sleep(4000);
		setMotorSpeed(fm,15);
		sleep(1000);

}

task main()
{
	while(1){
		while(getTouchValue(ts) == 0){
			sleep(500);
			displayBigTextLine(2,"n = %d",n); // 시간의 흐름을 보여줌
			n++;
			if(n == 10){
				food();
				water();
				n = 0;
			}
		}
		while(getTouchValue(ts) == 1){
			water();
		}
	}
}

```


# 최종 발표
[![최종 발표 동영상](http://img.youtube.com/vi/EpMMuc17u5E/0.jpg)](https://youtu.be/EpMMuc17u5E?t=0s)

최종 발표의 동영상은 [여기](https://youtu.be/EpMMuc17u5E)서 확인 가능합니다.

[![최종 발표 동영상 2](http://img.youtube.com/vi/7NC47wCmG0w/0.jpg)](https://youtu.be/7NC47wCmG0w?t=0s)

최종 발표의 동영상 2는 [여기](https://youtu.be/7NC47wCmG0w)서 확인 가능합니다.

### 최종 발표에 사용된 PPT 발표 자료
[이 곳](https://github.com/retrowavve/retrowavve.github.io/blob/master/assets/images/smart/saapresentation.pptx)에서 다운로드가 가능합니다.

# 느낀 점 및 배운 점

레고를 이용해 프로젝트를 진행하니, 필요한 부품이나 파트가 있으면 직접 조립해서 쓰면 된다는 점에서 창작의 재미를 느꼈다. 또한 프로그램 상으로만 어떻게 돌아가는지 확인하던 C 코드를 실제로 기계를 움직이는 데에 사용해 보니 어떤 원리로 돌아가는지 눈으로 확인하며 이해할 수 있었던 점이 좋았다.

구현하고자 했던 몇몇 부분들이 물리적인 부분이나 소프트웨어적인 부분으로 생각만큼 되지 않아 처음 생각했던 제품과는 약간의 차이가 있었지만, 이를 보완하면 더 좋은 프로토타입을 만들 수 있을 것 같다.
